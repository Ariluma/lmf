<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>LMF – Particle Flow (50.000 Blue Particles)</title>
<style>
  html,body{
    margin:0;
    padding:0;
    height:100%;
    overflow:hidden;
    background:#050714;
  }
  canvas{
    display:block;
    width:100vw;
    height:100vh;
    background:#050714;
  }
  .hud{
    position:fixed;
    top:12px;
    left:14px;
    padding:6px 10px;
    color:#dbe1ff;
    background:rgba(5,7,20,0.65);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:10px;
    font-family:-apple-system,system-ui;
    font-size:12px;
    backdrop-filter:blur(6px);
  }
</style>
</head>
<body>
<canvas id="flow"></canvas>
<div class="hud">LMF Particle Flow · 50.000 Punkte · Blau · Touch = Kraftfeld</div>

<script>
(function(){

  const canvas = document.getElementById("flow");
  const ctx = canvas.getContext("2d");

  let W = window.innerWidth;
  let H = window.innerHeight;

  function resize(){
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }
  resize();
  window.addEventListener("resize", resize);

  const BLUE = "#1437ff";
  const PARTICLES = 50000;

  const points = [];
  function resetPoint(p){
    p.x = Math.random()*W;
    p.y = Math.random()*H;
    p.vx = 0;
    p.vy = 0;
    p.life = 0;
    p.max = 4 + Math.random()*3;
  }

  // INITIALISIERUNG
  for(let i=0; i<PARTICLES; i++){
    const p = {x:0,y:0,vx:0,vy:0,life:0,max:0};
    resetPoint(p);
    points.push(p);
  }

  // ATTRACTORS
  const attractors = [];

  function addAttractor(x,y){
    if(attractors.length >= 5)
      attractors.shift();
    attractors.push({x,y});
  }

  function getPos(e){
    const r = canvas.getBoundingClientRect();
    if(e.touches && e.touches[0]){
      return {x:e.touches[0].clientX - r.left, y:e.touches[0].clientY - r.top};
    }
    return {x:e.clientX - r.left, y:e.clientY - r.top};
  }

  canvas.addEventListener("touchstart", e=>{
    const p = getPos(e);
    addAttractor(p.x,p.y);
  },{passive:false});

  canvas.addEventListener("click", e=>{
    const p = getPos(e);
    addAttractor(p.x,p.y);
  });

  let last = performance.now();
  function loop(now){
    const dt = Math.min(0.05,(now-last)/1000);
    last = now;

    // sanftes "Trail"-Verschwimmen
    ctx.fillStyle = "rgba(5,7,20,0.2)";
    ctx.fillRect(0,0,W,H);

    ctx.fillStyle = BLUE;
    ctx.beginPath();

    for(let i=0; i<PARTICLES; i++){
      const p = points[i];
      const oldX = p.x, oldY = p.y;

      let ax = 0, ay = 0;
      for(const a of attractors){
        const dx = a.x - p.x;
        const dy = a.y - p.y;
        const d2 = dx*dx + dy*dy + 30;
        const inv = 1/Math.sqrt(d2);
        const force = 160 * inv * inv;
        ax += dx*inv*force;
        ay += dy*inv*force;
      }

      p.vx += ax*dt;
      p.vy += ay*dt;

      p.vx *= 0.86;
      p.vy *= 0.86;

      p.x += p.vx*dt;
      p.y += p.vy*dt;
      p.life += dt;

      if(p.x<0 || p.x>W || p.y<0 || p.y>H || p.life>p.max){
        resetPoint(p);
        continue;
      }

      ctx.rect(p.x,p.y,1.1,1.1);
    }

    ctx.fill();
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);

})();
</script>
</body>
</html>
